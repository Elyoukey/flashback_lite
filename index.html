<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">

  <meta name="theme-color" content="#fafafa">

  <style>
    body{
      height:100%;
    }
    .splash{
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      text-align: center;
      background: #f1f1f1;
      z-index: 10;
      opacity: 1;
      visibility: visible;
      transition: opacity 500ms linear;
    }

    .splash.fadded{
      opacity: 0;
      visibility: hidden;
      transition: visibility 0s 500ms, opacity 500ms linear;
    }

    #container{
      height: 100%;
      width: 100%;
      position: absolute;
      padding: 0;
      box-sizing: border-box;
    }

    .card-menu{
      background: rgba( 0,0,0,0.6);
      line-height: 15px;
      width: 100%;

      box-sizing: border-box;

      white-space: nowrap;
      text-align: center;
      z-index: 5;

      overflow-x: auto;
      overflow-y: hidden;
    }

    .card-menu .menu-item{
      background: #3e2564;
      border: 2px solid #3e2564;
      border-radius: 7px;
      margin: 7px 10px;
      display: inline-block;
      overflow: hidden;
      text-align: center;
      width: 60px;
      height: 40px;

      pointer-events: none;
      perspective: 1000px;
    }
    .card-menu .menu-item.selected{
      border-color: #ffdb55;
    }
    .card-menu .menu-item .flip-card-inner {     /* This container is needed to position the front and back side */
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }

    .card-menu .menu-item.active .flip-card-inner{
      transform: rotateY(180deg);
      pointer-events: all;
    }

    .card-menu .menu-item .flip-card-front,
    .card-menu .menu-item .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden; /* Safari */
      backface-visibility: hidden;
    }

    /* Style the front side (fallback if image is missing) */
    .card-menu .menu-item .flip-card-back {
      background-color: #bbb;
      color: black;
    }

    /* Style the back side */
    .card-menu .menu-item .flip-card-front{
      background-color: dodgerblue;
      color: white;
      transform: rotateY(180deg);
    }

    .card-menu .menu-item img{
      height: 40px;
    }

    #canvas{
      text-align: center;
      box-sizing: border-box;
      border-radius: 20px;
      margin: 20px auto;
    }

    #canvas .puzzlepiece{
      height: 100%;
      width: auto;
      margin: auto;
      border: 10px solid #b655a0;
      border-radius: 15px;
      display: inline-block;

      position: relative;
      top:0;
      left:0;

    }

    @media (max-aspect-ratio: 4/3) {
      #canvas{
        width: 85%;
        height: auto;

      }
      #canvas .puzzlepiece .image{
        top:0;
        left:0;
        width: 100%;
        display: inline-block;
      }
    }
    @media (min-aspect-ratio: 4/3) {
      #canvas{
        height: 80%;
        width: auto;
        margin-top: 7px;
      }
      #canvas .puzzlepiece .image{
        height: 100%;
        width: auto;
      }
      .card-menu .menu-item{
        margin: 2px 20px;
      }
    }

    #canvas .puzzlepiece{
      display: none;
    }
    #canvas .puzzlepiece:target,
    #canvas .puzzlepiece.first-selected
    {
      opacity: 1;
      z-index: 1;
      display: inline-block;
    }

    #canvas .puzzlepiece .hiddenbutton{
      cursor: default;
      b-ackground: red;
      opacity: 0.3;
    }
    #canvas .puzzlepiece .hiddenanchor{
      cursor: default;
      background: red;
      opacity: 0.3;
    }

    /* questions */
    #canvas #question-list .question{
      perspective: 1000px;
    }
    #canvas #question-list .question img{
      width: 100%;
    }
    #canvas #question-list .question .flip-card-inner {     /* This container is needed to position the front and back side */
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }

    #canvas #question-list .question.active .flip-card-inner{
      transform: rotateY(180deg);
    }
    #canvas #question-list .question .flip-card-front,
    #canvas #question-list .question .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden; /* Safari */
      backface-visibility: hidden;
    }

    /* Style the front side (fallback if image is missing) */
    #canvas #question-list .question .flip-card-back {
      background-color: #bbb;
      color: black;
    }

    /* Style the back side */
    #canvas #question-list .flip-card-front{
      color: white;
      transform: rotateY(180deg);
    }


    /* Style for tuto */
    #first-overlay{
      position: fixed;
      background: rgba(0,0,0,.5);
      width: 100%;
      height: 100%;
      top:0;
      left:0;
      z-index: 11;
    }

    #hint-magnifier{
      position: fixed;
      border: 1px solid rgba(0,0,0,.5);
      border-radius: 50%;
      z-index:11;
      overflow: visible;

      width: 500px; /* set in js */
      height: 500px; /* set in js */
      top:-70%; /* set in js */
      left:-70%; /* set in js */

      transition-property: width, height, top, left;
      transition-duration: 500ms;
      transition-timing-function: linear;

    }


    #hint-magnifier .magnifying-glass{
      width: 110%;
      position:absolute;
      left: -5%;
      top: -5%;
    }

    #hint-magnifier .hiddenbutton{
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      position: absolute;
    }

    /**/
    .tuto-text{
      display: block;
      position:relative;
      width: 400px;
      color: #3f007f;
      background: #ffdb55;
      text-align: center;
      border-radius: 7px;
      padding: 10px;
      font-weight: bold;

      display: none;
      z-index:12;
    }


  </style>
</head>

<body>
<!--
<div id="splash-1" class="splash">
  <p>
    <i>Welcome Flavor text 1 </i>
  </p>
  <button onclick="$('splash-1').classList.add('fadded');">
    Commencer
  </button>
</div>
<div id="splash-2" class="splash fadded">
  <p>
    <i>Well done flavor text2 </i>
  </p>
</div>
-->
<div id="container">

  <!-- ----------------------------------------------------------MENU --------------------------------------- -->
  <div class="card-menu" id="left-menu">
    <a class="menu-item active selected" id="menu1" href="#card1">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="img/game/p-01color.jpg" alt="First card" >
        </div>
        <div class="flip-card-back">
          <img src="img/game/card-background-1.jpg" alt="First card" >
        </div>
      </div>
    </a>
    <a class="menu-item" id="menu-card2" href="#card2" >
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="img/game/p-02color.jpg" alt="2nd card" >
        </div>
        <div class="flip-card-back">
          <img src="img/game/card-background-2.jpg" alt="2nd card" >
        </div>
      </div>
    </a>
    <a class="menu-item" id="menu3" href="#card3">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="img/game/p-03color.jpg" alt="3rd card" >
        </div>
        <div class="flip-card-back">
          <img src="img/game/card-background-3.jpg" alt="3rd card" >
        </div>
      </div>
    </a>
    <a class="menu-item"  id="menu4" href="#card4">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="img/game/p-04color.jpg" alt="4th card" >
        </div>
        <div class="flip-card-back">
          <img src="img/game/card-background-4.jpg" alt="4th card" >
        </div>
      </div>
    </a>
    <a class="menu-item" id="menu5" href="#card5">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="img/game/p-05color.jpg" alt="5th card" >
        </div>
        <div class="flip-card-back">
          <img src="img/game/card-background-5.jpg" alt="5th card" >
        </div>
      </div>    </a>
    <a class="menu-item" id="menu6" href="#card6">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="img/game/p-06color.jpg" alt="6th card" >
        </div>
        <div class="flip-card-back">
          <img src="img/game/card-background-6.jpg" alt="6th card" >
        </div>
      </div>
    </a>
    <a class="menu-item" id="menu7" href="#card7">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="img/game/p-07color.jpg" alt="7th card" >
        </div>
        <div class="flip-card-back">
          <img src="img/game/card-background-7.jpg" alt="7th card" >
        </div>
      </div>
    </a>
    <a class="menu-item" id="menu8" href="#question-list">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="img/game/questions.jpg" alt="7th card" >
        </div>
        <div class="flip-card-back">
          <img src="img/game/card-background.jpg" alt="7th card" >
        </div>
      </div>
    </a>
  </div>

  <!-- ----------------------------------------------------------CANVAS --------------------------------------- -->

  <div id="canvas">

    <div class="puzzlepiece first-selected" id="card1" data-scale="0" >
      <img src="img/game/p-01color.jpg" class="image" />

      <a id="hint-0-anchor" class="hiddenanchor" style=" position: absolute; left:50%; top:50%; width:0%;height:0%;"> </a>
      <a id="hint-doghead-anchor" class="hiddenanchor" style=" position: absolute; left:28%; top:48%; width:18%;height:18%;"> </a>
      <a id="hint-question1-anchor" class="hiddenbutton" style=" position: absolute; left: 68%; top: 62%; width: 14%; height:12%;"> </a>

      <a id="tuto-text-1-anchor" class="hiddenanchor" style=" position: absolute; left:10%; top: 10%; width:10%;height:10%;"> </a>
      <a id="tuto-text-2-anchor" class="hiddenanchor" style=" position: absolute; left:10%; top: 10%; width:10%;height:10%;"> </a>
      <a id="tuto-text-4-anchor" class="hiddenanchor" style=" position: absolute; left:10%; top: 10%; width:10%;height:10%;"> </a>

      <a id="card1-doghead" class="hiddenbutton" href="#card2" style="position: absolute; left:28%; top:51%; width:15%;height:18%;"> </a>
      <a id="card1-retro" class="hiddenbutton" href="#card3" style=" position: absolute; left: 68%; top: 9%; width: 31%; height:24%;  transform: rotate(-30deg)"> </a>
      <a id="card1-question1" class="hiddenbutton" href="#question-list" style=" position: absolute; left: 70%; top: 66%; width: 12%; height:12%;"> </a>
    </div>
    <div class="puzzlepiece " id="card2" data-scale="0" >
      <img src="img/game/p-02color.jpg" class="image" />
      <a id="hint-boyhead-anchor" class="hiddenbutton" href="#card1" style="position: absolute; left: 49%; top: 3%; width: 13%; height: 20%; "> </a>
      <a id="tuto-text-3-anchor" class="hiddenanchor" style=" position: absolute; left:10%; top: 10%; width:10%;height:10%;"> </a>
      <a id="card2-boy" class="hiddenbutton" href="#card1" style="position: absolute; left: 49%; top: 3%; width: 13%; height: 20%; "> </a>
      <a id="card2-zombie" class="hiddenbutton" href="#card4" style="position: absolute; left: 19%; top:50%; width: 11%;height:11%; "> </a>
      <a id="card2-question2" class="hiddenbutton" href="#question-list" style="position: absolute; left: 15%; top: 30%; width: 11%; height:12%; "> </a>
    </div>
    <div class="puzzlepiece " id="card3" data-scale="0" >
      <img src="img/game/p-03color.jpg"  class="image" />
      <a id="card3-visiere" class="hiddenbutton" href="#card5" style="position: absolute; left: 41%; top: 58%; width: 15%; height: 9%; "> </a>
    </div>
    <div class="puzzlepiece " id="card4" data-scale="0" >
      <img src="img/game/p-04color.jpg" class="image" />
      <a id="card4-dog" class="hiddenbutton" href="#card2" style="position: absolute; left: 63%; top: 11%; width: 9%; height: 12%; "> </a>
    </div>
    <div class="puzzlepiece " id="card5" data-scale="0" >
      <img src="img/game/p-05color.jpg" class="image" />
      <a id="card5-head" class="hiddenbutton" href="#card6" style="position: absolute; left: 31%; top: 43%; width: 10%; height: 15%; "> </a>
    </div>
    <div class="puzzlepiece " id="card6" data-scale="0" >
      <img src="img/game/p-06color.jpg" class="image" />
      <a id="card6-clown" class="hiddenbutton" href="#card7" style="position: absolute; left: 45%; top: 87%; width: 16%; height: 13%; "> </a>
      <a id="card6-question3" class="hiddenbutton" href="#question-list" style="position: absolute; left: 74%; top: 30%; width: 11%; height:11%; "> </a>
    </div>
    <div class="puzzlepiece " id="card7" data-scale="0" >
      <img src="img/game/p-07color.jpg" class="image" />
    </div>
    <div id="question-list" class="puzzlepiece" data-targeter="menu8">
      <img src="img/game/empty_blue.jpg" class="image" />
      <div class="question" id="question1" style="position: absolute; left: 5%; top: 5%; width: 25%; height: 25%; ">&nbsp;
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="img/game/question1.jpg" alt="Quest ce qui a causé l'accident du kidz à vélo ?" />
            </div>
            <div class="flip-card-back">
              <img src="img/game/card-background.jpg" alt="background " />
            </div>
          </div>
      </div>
      <div class="question" id="question2" style="position: absolute; left: 35%; top: 40%; width: 25%; height: 25%; ">
        <div class="flip-card-inner">
          <div class="flip-card-front">
            <img src="img/game/question2.jpg" alt="7th card" >
          </div>
          <div class="flip-card-back">
            <img src="img/game/card-background.jpg" alt="7th card" >
          </div>
        </div>
      </div>
      <div class="question" id="question3" style="position: absolute; left: 70%; top: 70%; width: 25%; height: 25%; ">
        <div class="flip-card-inner">
          <div class="flip-card-front">
            <img src="img/game/question3.jpg" alt="7th card" >
          </div>
          <div class="flip-card-back">
            <img src="img/game/card-background.jpg" alt="7th card" >
          </div>
        </div>
      </div>
      <button onclick="$('splash-2').classList.remove('fadded');" style="position: absolute; left: 45%; top: 87%; width: 16%; height: 10%; ">
        Fin du jeu!
      </button>
    </div>



  </div>

</div>

<!-- ---------------------------------------------------------- TUTO --------------------------------------- -->

<!-- full overlay without the magnifying glass -->
<div id="first-overlay"></div>

<!-- Magnifier -->
<div id="hint-magnifier" class="hint">
  <img class="magnifying-glass" src="img/game/loupe.png" />

  <!-- links -->
  <a id="tuto-next-step4" class="hiddenbutton" href="#question-list" ></a>
  <a id="tuto-next-step3" class="hiddenbutton" href="#card1" ></a>
  <a id="tuto-next-step2" class="hiddenbutton" href="#card2" ></a>
</div>

<!-- texts -->
<div id="texts-tuto">

  <div id="text-tuto-1" class="tuto-text">
    <p>Dans Flashback, tu voyages dans un souvenir. Chaque souvenir est une seconde précise figée dans le temps. Tout ce que tu y vois appartient au passé. Voici la première carte du premier souvenir.</p>
    <button id="tuto-next-step1">Suivant</button>
  </div>
  <div id="text-tuto-2" class="tuto-text">Tu peux voir ce que voit un autre personnage, un zombie, un animal et même certains objets, comme des caméras!</div>
  <div id="text-tuto-3" class="tuto-text">Voyage d’un point de vue à un autre, parmi tous ceux que tu aperçois sur la carte.</div>
  <div id="text-tuto-4" class="tuto-text">Découvre des indices, élucide les mystères et déjoue les plans des zombies!</div>
</div>


<!-- -->
  <script src="js/vendor/modernizr-3.11.2.min.js"></script>
  <script src="js/plugins.js"></script>

  <script>
      /* ------------------------------------------------------Utilities */
      function $(id){ return document.getElementById(id);}
      function $_(q){ return document.querySelector(q);}
      function $_s(q){ return document.querySelectorAll(q);}

      /* --------------------------------------------------- Variables */
      var lastPosX = 0; // for image dragging
      var lastPosY = 0; // for image dragging
      var isDragging = false; // for image dragging
      var isPinching = false; // for image dragging

      /* ----------------------------------------------------- Dom elements */
      var $puzzlepieces;
      var $hiddenbuttons;
      var $menupieces;
      var $canvas;
      var $tutohintMagnifier;

      /* ----------------------------------------------------- DOM load */
      document.addEventListener("DOMContentLoaded", function() {

        // initiate dom elements
        $menupieces = $_s('#left-menu .menu-item');
        $puzzlepieces = $_s('#canvas .puzzlepiece');
        $firstpuzzlepiece = $_('#canvas .puzzlepiece.first-selected');
        $hiddenbuttons = $_s('.hiddenbutton');
        $tutoTexts = $_s('.tuto-text');
        $canvas = $('canvas');
        $tutohintMagnifier = $('hint-magnifier');

        // redirect to card 1 if current #card is not active
        let hash = window.location.hash;
        if (hash) {
          if (!$_(hash).classList.contains('active')) {
            window.location = window.location.href.replace(window.location.hash, "");
          }
        }

        // menu selection
        for (let i = 0; i < $menupieces.length; i++) {
          $menupieces[i].addEventListener('click', function (e) {
            for (let i = 0; i < $menupieces.length; i++) {
              $menupieces[i].classList.remove('selected');
            }
            this.classList.add('selected');
          });
        }

        // menu activation
        for (let i = 0; i < $hiddenbuttons.length; i++) {
          $hiddenbuttons[i].addEventListener('click', function (e) {
            $firstpuzzlepiece.classList.remove('first-selected'); //remove first selected
            for (let i = 0; i < $menupieces.length; i++) {
              if (this.getAttribute('href') == $menupieces[i].getAttribute('href')) {
                $menupieces[i].classList.add('active');
                for (let j = 0; j < $menupieces.length; j++) {
                  $menupieces[j].classList.remove('selected');
                }
                $menupieces[i].classList.add('selected');
              }
            }
          });
        }

        // question activation
        $('card1-question1').addEventListener('click',function(e){ activateQuestion($('question1'),0);} );
        $('card2-question2').addEventListener('click',function(e){ activateQuestion($('question2'),0);});
        $('card6-question3').addEventListener('click',function(e){ activateQuestion($('question3'),0);});

        // tuto positionning
        // tuto step 1
        positionText($('tuto-text-1-anchor'),$('text-tuto-1'),0);

        // tuto step 2
        $('tuto-next-step1').addEventListener('click',function(){
          magnify($('hint-doghead-anchor'),0);
          positionText($('tuto-text-2-anchor'),$('text-tuto-2'),0);
        });

        // tuto step 3
        $('tuto-next-step2').addEventListener('click',function(){
          positionText($('tuto-text-3-anchor'),$('text-tuto-3'),0);
          magnify($('hint-boyhead-anchor'),0);
          this.remove();
        });

        // tuto step 4
        $('tuto-next-step3').addEventListener('click',function(){
          positionText($('tuto-text-4-anchor'),$('text-tuto-4'),0);
          magnify($('hint-question1-anchor'),0);
          this.remove();
        });

        // tuto step 5
        $('tuto-next-step4').addEventListener('click',function(){
          activateQuestion($('question1'),0);
          $('hint-magnifier').remove();
          $('texts-tuto').remove();
          this.remove();
        });



      });


      function magnify(hintTarget, attempt) {
        let linkpos = hintTarget.getBoundingClientRect();
        if(linkpos.height==0 && attempt < 10 ){
          attempt++;
          setTimeout( magnify , 100, hintTarget, attempt);
          return;
        }
        let radius = Math.max( window.innerWidth,window.innerHeight);
        radius += 1000; // to be sure to be out of the window
        $tutohintMagnifier.style.borderWidth = radius+'px';

        let topPos = Math.ceil( radius - linkpos.top ) ;
        let leftPos = Math.ceil( radius - linkpos.left ) ;
        $tutohintMagnifier.style.top = '-'+topPos+'px';
        $tutohintMagnifier.style.left = '-'+leftPos+'px';
        $tutohintMagnifier.style.width = linkpos.width + 'px';
        $tutohintMagnifier.style.height = linkpos.width + 'px'; // square to get a circle

        // remove default overlay
        $('first-overlay').style.display='none';
      }

      function positionText(textTarget, textTuto, attempt){
        let linkpos = textTarget.getBoundingClientRect();
        if(linkpos.height==0 && attempt < 10 ){
          attempt++;
          console.log(attempt);
          setTimeout( positionText , 100, textTarget, textTuto, attempt);
          return;
        }
        console.log(attempt);
        textTuto.style.top = linkpos.top+'px';
        textTuto.style.left = linkpos.left+'px';
        for(let i =0; i< $tutoTexts.length; i++){
          $tutoTexts[i].style.display='none';
        }
        textTuto.style.display = 'block';
      }

      function activateQuestion(questionTarget, attempt) {
        let linkpos = questionTarget.getBoundingClientRect();
        if(linkpos.height==0 && attempt < 10 ){
          attempt++;
          setTimeout( activateQuestion , 100, questionTarget, attempt);
          return;
        }
        questionTarget.classList.add('active');
      }


  </script>
</body>

</html>
